<html>
<head>
</head>


<body>
<canvas id="myCanvas"></canvas>
<script src="js/three.min.js"></script>
<script src="js/OBJLoader.js"></script>
<script src="js/FirstPersonControls.js"></script>	
	
	
<script>

window.onload = () => {    
var personControl = true;   
var camera, scene, renderer, player, clock;
var INV_MAX_FPS = 0.01, frameDelta = 0;

myCanvas = document.getElementById('myCanvas');


//RENDERER
renderer = new THREE.WebGLRenderer( {
  canvas: myCanvas, 
  antialias: true
} );
renderer.setClearColor(0x000000);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);


//CAMERA
camera = new THREE.PerspectiveCamera( 120, window.innerWidth / window.innerHeight, 0.1, 1000 );
camera.position.y = 2;
camera.position.x = 66;
camera.position.z = 5;
	
clock = new THREE.Clock();
player = new THREE.FirstPersonControls(camera);
player.movementSpeed = 100;
player.lookSpeed = 0.1;


scene = new THREE.Scene();
var light = new THREE.AmbientLight(0xffffff, 0.5);
light.position.set(5, 5, 5);
scene.add(light);

var pLight = new THREE.PointLight( 0xffffff, 2.5 );
pLight.position.set( 0, 5, 0);
scene.add( pLight );


var floorGeometry = new THREE.PlaneGeometry(1000, 1000, 5, 5);
var floorMap = new THREE.TextureLoader().load( 'assets/stone.jpg' )
floorMap.wrapS = floorMap.wrapT = THREE.RepeatWrapping; 
floorMap.repeat.set(55, 55); 
var floorMaterial = new THREE.MeshPhongMaterial( { map: floorMap } );	
var floorMesh = new THREE.Mesh(floorGeometry, floorMaterial);
floorMesh.receiveShadow = true;
floorMesh.position.x = -300; 
floorMesh.position.y = -2.0;		
floorMesh.rotation.x = -0.5 * Math.PI;
scene.add(floorMesh); 	
    
	
var delta = 0;
var prevTime = Date.now();	


/*******************************************************************/

var OBJLoader = new THREE.OBJLoader()
var textureLoader = new THREE.TextureLoader()
var textureBooks = textureLoader.load( 
  'assets/books.jpg',
  function () {
    OBJLoader.load( 'assets/walls.obj', function( obj ) {
      var matBooks = new THREE.MeshPhongMaterial( { 
        color: 0x332233,  
        map: textureBooks  
      } )
      matBooks.map.wrapS = matBooks.map.wrapT = THREE.RepeatWrapping; 
      var mat = new THREE.MeshPhongMaterial( { 
        color: 0x332233,  
        map: textureBooks  
      } ) 
	    obj.traverse( function( child ){
        if ( child instanceof THREE.Mesh != true ) return
        if ( child.name == 'books' ) {
          var mesh = new THREE.Mesh( child.geometry, matBooks )
	        scene.add( mesh )
        } else {
          var mesh = new THREE.Mesh( child.geometry, mat )
	        scene.add( mesh )          
        }  
      }) 
    })    
  }
)			






requestAnimationFrame( function animate() {
    if (personControl == true ){	
      draw();
      frameDelta += clock.getDelta();
        while (frameDelta >= INV_MAX_FPS) {				
        player.update(INV_MAX_FPS);						
        frameDelta -= INV_MAX_FPS;
      }
      requestAnimationFrame( animate );
    }				
});	
	
function draw() {
  //console.log( 'x: ',  camera.position.x, ' z: ', camera.position.z )
  pLight.position.x = camera.position.x
  pLight.position.z = camera.position.z
  delta += 0.1;
  renderer.render(scene, camera);
}

}	
	
 

    </script>
</body>
</html>
